由于我们是做的前后端分离，所以所有的数据都是通过 Ajax 发送到服务端获取的。

# 基本请求

```javascript
API.get(apiName, params, successHandler, ismock)
```
对应的参数表示：

- `apiName`: 要调用的接口名
- `params`: 传入的参数
- `successHandler`: 请求成功的回掉 function(data){}
- `ismock`：是否走本地的 mock 数据

# Mock数据

前后端分离后我们可以实现开发的同时进行，这时我们就需要在后端未开发完接口之前就可以进行前端页面的开发，那么自然而然就要做接口数据的模拟了。

在对应的 mock 数据目录（`/src/js/mock/API/`）下创建数据（与接口名相同）文件。

比如我们有一个名为 `getPostList` 的接口，那么我们需要创建一个 `/src/js/mock/getPostList.js` 文件：

```javascript
module.exports = { 
  items: [
    {name: '文章标题1'},
    {name: '文章标题2'},
    {name: '文章标题3'},
    {name: '文章标题4'}
  ]
}
```
那么实际上上面的的导出数据就相当于后台返回的数据了，接下来就可以在 `successHandler` 中处理和展示数据了。


# 分页列表

我们经常会遇到这种获取数据列表并分页展示的场景，那么为了方便使用，我们对其进行了封装，使用的方法很简单：

1、给最外层数据列表的容器添加一个 ID（如果该页面中只有一个数据列表，则设置为 `#data-list`）

2、在视图中需要显示分页的指定位置加入下面的代码
```jade
div.pagination
```
3、调用 `API.list(...)` 方法

```javascript
API.list(apiName, params, successHandler, extra, ismock)
```
如果想自定义每页显示数量可以传入 `extra` 参数中的 `pagination`，格式如下（下面均为默认值）：

```javascript
pagination: {
  pagesize: 15, //- 每页的数据条数
  page: 1 //- 从第几页开始显示
}
```

4、如果第一步中设置的 ID 不为 `#data-list` 那么则需要再给 `extra` 加一个对象

```javascript
wraper: '#goods-list'
```


# 加载动画

在加载数据的过程中（或分页切换）给用户显示一个加载动画会大大提升用户体验。

1、给最外层数据列表的容器添加一个 ID（如果该页面中只有一个数据列表，则设置为 `#data-list`）

2、在视图中需要显示加载动画的指定位置加入下面的代码

```jade
div.loading
```
3、如果第 1 步中设置的 ID 不为 `#data-list` 那么则需要再给 `extra` 加一个对象

```javascript
wraper: '#goods-list'
```

4、如果想在加载动画显示中的时候让数据列表隐藏，则需要给该元素手动加上 `.data-list` 样式


# 表单验证提交

常见的新增或编辑页面，由于字段数量很大，所以不可能直接在 AJAX 请求中去将字段一个一个传入，而且我们需要对某些字段进行验证

#### 1、按照如下格式新建表单元素，给表单加上一个唯一 ID

```jade
div.box-body
  form#form1
    div.form-group
      label 用户名
      input(type="text" class="form-control" name="username")

    div.form-group
      button.btn.btn-default 添加  
```

#### 2、在对应 JS 类的 init() 方法中注册

```javascript
Core.submiForm($form, validation, action)
```
- `$form` 表单元素ID
- `validation` 验证对象，包含 `rule` 和 `message` 详细用法请查看 [官方文档](https://jqueryvalidation.org/validate)
- `action` 表单验证通过后要执行的提交操作，包含一个 `fields` 参数，表示表单中所有字段的 `{name: value}` 对象

例子：

```javascript
Core.submiForm('#form1', {
  rules:{
    username: {required: true} , 
  },
  messages: {
    username: '用户名不能为空'
  }
}, (fields)=> {
  User.new(fields).save().then((data)=> {
    Core.alert('success', '添加会员成功')
    window.location.href = '/mem/list'
  })
})
```


# 数据格式化显示

#### 1、日期格式化

通常后端返回的日期是一个时间戳格式，我们需要在渲染的时候显示本地化时间格式，那么只需要在绑定的地方加上一个过滤器 `localDate` 即可

```jade
p 生效时间：{{order.sell_order_time | localDate}}
```
上面的时间戳会被格式化成 `2015-03-22  13:22:19` 
